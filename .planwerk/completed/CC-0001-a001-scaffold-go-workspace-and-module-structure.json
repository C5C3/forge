{
  "feature_id": "CC-0001",
  "title": "A001: Scaffold Go workspace and module structure",
  "slug": "a001-scaffold-go-workspace-and-module-structure",
  "status": "completed",
  "phase": "awaiting_external_review",
  "summary": "",
  "description": "**Size:** ðŸ—ï¸ large\n**Category:** infrastructure\n**Priority:** critical\n\n## Open Questions\n\nAll questions resolved â€” user decisions incorporated below.\n\n## Summary\n\nScaffold the foundational Go workspace and module structure for the CobaltCore monorepo. This creates `go.work` with three modules (`internal/common`, `operators/keystone`, `operators/c5c3`), initializes `go.mod` per module with controller-runtime/apimachinery dependencies, scaffolds minimal `main.go` entrypoints for both operators (manager setup, scheme registration, leader election, health probes), and provides the top-level `Makefile` and `golangci-lint` configuration. This is S001 from the implementation plan â€” the base layer upon which all subsequent features (S002â€“S026) build.\n\n## Scope\n\n**Included:**\n- `go.work` with `use` directives for 3 modules (Go 1.25 â€” user decision, matching docs)\n- Directory tree: `internal/common/`, `operators/keystone/`, `operators/c5c3/`, `images/`, `releases/`, `deploy/`, `tests/e2e/` â€” placeholder dirs get `.gitkeep`\n- `go.mod` for each module with `controller-runtime v0.23+`, `k8s.io/apimachinery v0.35+`, `k8s.io/client-go v0.35+`\n- `replace` directives in operator `go.mod` files for `internal/common` (CI builds without `go.work`)\n- `main.go` for `operators/keystone` and `operators/c5c3` with: scheme registration (runtime + k8s core schemes), `ctrl.NewManager`, leader election (`--leader-elect` flag), health/readiness probes (`/healthz`, `/readyz`), metrics bind address, controller registration stub (no-op comment until reconcilers exist)\n- Top-level `Makefile` with targets: `generate`, `manifests`, `build`, `test`, `test-integration`, `lint`, `docker-build`, `helm-package`, `e2e`, `deploy-infra` (stub), `install-test-deps` (stub) â€” with `OPERATOR` variable for targeting individual operators\n- `.golangci.yml` with standard linters and exclusions for generated code (`zz_generated.*`)\n- `internal/common/doc.go` â€” package doc placeholder so the module compiles\n- `go.sum` files generated via `go mod tidy`\n\n**Excluded (with rationale):**\n- CRD type definitions, `api/v1alpha1/` â€” S011, YAGNI until reconciler work starts\n- Controller/reconciler implementations â€” S013\n- Shared library packages (`internal/common/conditions/`, `config/`, etc.) â€” S004, S005\n- Helm chart scaffolding â€” S017\n- Dockerfiles in `images/` â€” S006\n- GitHub Actions CI workflows â€” S003\n- Test suites (envtest setup, Chainsaw tests) â€” S002, S012, S014\n- Webhook configuration â€” S011, no types exist yet\n- Kubebuilder `config/` directories (crd, rbac, manager manifests) â€” S011\n- Operator SDK scaffolding (`operator-sdk init`) â€” creates too many files we'd delete; hand-crafted `main.go` matches documented patterns better\n\n## Visualization\n\n```mermaid\nflowchart TD\n    subgraph root[\"Repository Root\"]\n        gowork[\"go.work\"]\n        makefile[\"Makefile\"]\n        lint[\".golangci.yml\"]\n    end\n\n    subgraph common[\"internal/common/\"]\n        gomod_c[\"go.mod\"]\n        doc_c[\"doc.go\"]\n    end\n\n    subgraph keystone[\"operators/keystone/\"]\n        gomod_k[\"go.mod\"]\n        main_k[\"main.go\"]\n    end\n\n    subgraph c5c3[\"operators/c5c3/\"]\n        gomod_cc[\"go.mod\"]\n        main_cc[\"main.go\"]\n    end\n\n    subgraph placeholders[\"Placeholder Directories\"]\n        images[\"images/.gitkeep\"]\n        releases[\"releases/.gitkeep\"]\n        deploy[\"deploy/.gitkeep\"]\n        tests[\"tests/e2e/.gitkeep\"]\n    end\n\n    gowork -->|\"use ./internal/common\"| common\n    gowork -->|\"use ./operators/keystone\"| keystone\n    gowork -->|\"use ./operators/c5c3\"| c5c3\n\n    gomod_k -->|\"require + replace\"| gomod_c\n    gomod_cc -->|\"require + replace\"| gomod_c\n\n    main_k -->|\"ctrl.NewManager\"| CR[\"controller-runtime\"]\n    main_cc -->|\"ctrl.NewManager\"| CR\n\n    makefile -->|\"iterates OPERATOR\"| keystone\n    makefile -->|\"iterates OPERATOR\"| c5c3\n    lint -->|\"applies to all modules\"| common\n```\n\n```mermaid\nflowchart LR\n    subgraph main_go[\"main.go Structure\"]\n        A[\"Register Schemes\"] --> B[\"Create Manager\"]\n        B --> C[\"Enable Leader Election\"]\n        C --> D[\"Setup Health Probes\"]\n        D --> E[\"Controller Stub\"]\n        E --> F[\"mgr.Start\"]\n    end\n```\n\n## Key Components\n\n- **`go.work`** â€” Workspace root linking 3 modules; Go 1.25; enables local resolution of `internal/common`\n- **`internal/common/go.mod`** â€” Shared library module (`github.com/c5c3/forge/internal/common`); minimal deps (apimachinery, controller-runtime for types only); `doc.go` placeholder so the module compiles\n- **`operators/keystone/go.mod`** â€” Module `github.com/c5c3/forge/operators/keystone`; full controller-runtime + client-go deps; `replace` directive for `internal/common` per docs (`architecture/01-project-setup.md:112-126`)\n- **`operators/c5c3/go.mod`** â€” Module `github.com/c5c3/forge/operators/c5c3`; same dependency pattern as keystone\n- **`operators/*/main.go`** â€” Entrypoints with: scheme registration (runtime scheme + k8s core), `ctrl.NewManager(...)`, `--leader-elect` flag, health probe endpoints (`/healthz`, `/readyz`), metrics bind address (`:8080`), `// TODO: register controllers here` stub, `mgr.Start(ctrl.SetupSignalHandler())`\n- **`Makefile`** â€” Multi-operator build orchestration; `OPERATOR` variable to target individual operators (per docs `architecture/01-project-setup.md:146-152`); `OPERATORS` list defaults to `keystone c5c3`; `deploy-infra` and `install-test-deps` as stubs; all 11 requested targets\n- **`.golangci.yml`** â€” Enables `govet`, `errcheck`, `staticcheck`, `unused`, `gosimple`, `ineffassign`, `typecheck`, `gocritic`; excludes `zz_generated*.go`; Go 1.25 target\n- **Placeholder dirs** â€” `images/`, `releases/`, `deploy/`, `tests/e2e/` with `.gitkeep` for future S003/S006/S002 work\n\n## Deviation Note\n\nThe user chose **Go 1.25** over the documented Go 1.25 (`architecture/01-project-setup.md:11,158`). All `go.work` and `go.mod` files will use `go 1.25`. The docs should be updated separately to reflect this decision.",
  "stories": [
    {
      "title": "Developer builds all operators from workspace root",
      "role": "developer",
      "want": "to compile all operator binaries with a single command from the repository root",
      "so_that": "I can verify the entire project builds correctly after making changes",
      "criteria": [
        "`make build` compiles both keystone and c5c3 operator binaries without errors",
        "`go build ./...` succeeds when run from the workspace root with go.work present",
        "Each operator binary is individually buildable via `go build` in its module directory",
        "`go vet ./...` reports no issues for any module in the workspace"
      ]
    },
    {
      "title": "Developer targets individual operator builds via Makefile",
      "role": "developer",
      "want": "to build, test, and lint a single operator without affecting others",
      "so_that": "I can iterate quickly on one operator during development",
      "criteria": [
        "`make build OPERATOR=keystone` only compiles the keystone operator binary",
        "`make lint OPERATOR=c5c3` only runs golangci-lint on the c5c3 module",
        "Running `make build` without OPERATOR compiles all operators (keystone + c5c3)",
        "OPERATOR variable works consistently for all applicable targets (build, test, lint)"
      ]
    },
    {
      "title": "CI system builds operators independently without go.work",
      "role": "CI pipeline",
      "want": "each operator module to be buildable using replace directives in go.mod",
      "so_that": "CI can build individual operator modules without depending on the workspace file",
      "criteria": [
        "`GOWORK=off go build ./...` in operators/keystone/ succeeds using replace directives",
        "Replace directive in operators/keystone/go.mod maps internal/common to ../../internal/common",
        "Replace directive in operators/c5c3/go.mod maps internal/common to ../../internal/common",
        "`go mod tidy` does not remove the replace directives because internal/common is imported"
      ]
    },
    {
      "title": "Developer has consistent lint configuration across all modules",
      "role": "developer",
      "want": "a single golangci-lint configuration enforcing uniform code quality standards",
      "so_that": "all modules follow the same coding standards and catch common issues early",
      "criteria": [
        ".golangci.yml at repository root is used by golangci-lint for all modules",
        "Generated files matching zz_generated*.go are excluded from all linter checks",
        "Standard linters (govet, errcheck, staticcheck, unused, gosimple, ineffassign, gocritic) are enabled",
        "`make lint` exits 0 on the scaffolded codebase with zero lint violations"
      ]
    },
    {
      "title": "Developer extends the project with new operators following established patterns",
      "role": "developer",
      "want": "a clear, repeatable structure for adding new operator modules to the workspace",
      "so_that": "future operators (glance, nova, neutron, etc.) follow the same conventions",
      "criteria": [
        "operators/keystone/main.go and operators/c5c3/main.go follow identical structural patterns",
        "operators/keystone/go.mod and operators/c5c3/go.mod have matching dependency and replace structure",
        "Adding a new operator requires: create directory, create go.mod, create main.go, add use directive to go.work, add name to OPERATORS in Makefile",
        "Reference documentation describes the workspace structure and module addition process"
      ]
    },
    {
      "title": "Platform engineer verifies operator health via standard probe endpoints",
      "role": "platform engineer",
      "want": "both operators to expose /healthz and /readyz probe endpoints for Kubernetes",
      "so_that": "Kubernetes can determine operator liveness and readiness for scheduling decisions",
      "criteria": [
        "Manager is configured with HealthProbeBindAddress (default :8081)",
        "/healthz endpoint is registered via mgr.AddHealthzCheck with healthz.Ping",
        "/readyz endpoint is registered via mgr.AddReadyzCheck with healthz.Ping",
        "Leader election is configurable via --leader-elect flag (default false for local dev)"
      ]
    }
  ],
  "requirements": [
    {
      "id": "REQ-001",
      "description": "go.work SHALL reference all three modules (internal/common, operators/keystone, operators/c5c3) with Go 1.25 and enable local module resolution",
      "priority": "SHALL",
      "rationale": "The Go workspace is the foundation enabling multi-module development without publishing modules to a registry; it must correctly link all modules for local resolution",
      "scenarios": [
        {
          "name": "All modules resolve via workspace",
          "when": "developer runs `go build ./...` from the repository root with go.work present",
          "then": "all three modules are resolved locally and compilation succeeds",
          "and_then": [
            "no network fetch is attempted for internal/common"
          ]
        },
        {
          "name": "go.work specifies Go 1.25",
          "when": "developer inspects go.work",
          "then": "the file contains `go 1.25` as the Go version directive",
          "and_then": [
            "version matches all go.mod files"
          ]
        },
        {
          "name": "Missing module directory causes clear error",
          "when": "a use directive references a non-existent directory",
          "then": "go build reports a clear error identifying the missing module path",
          "and_then": [
            "error message includes the expected directory path"
          ]
        }
      ]
    },
    {
      "id": "REQ-002",
      "description": "Each go.mod SHALL declare the correct module path, Go 1.25, and pin controller-runtime v0.23.x, k8s.io/apimachinery v0.35.x, k8s.io/client-go v0.35.x",
      "priority": "SHALL",
      "rationale": "Correct module paths and pinned dependency versions ensure reproducible builds and Kubernetes ecosystem compatibility",
      "scenarios": [
        {
          "name": "internal/common module path is correct",
          "when": "developer reads internal/common/go.mod",
          "then": "module path is `github.com/c5c3/forge/internal/common` with `go 1.25`",
          "and_then": [
            "`go mod verify` succeeds"
          ]
        },
        {
          "name": "Operator module paths follow convention",
          "when": "developer reads operators/keystone/go.mod",
          "then": "module path is `github.com/c5c3/forge/operators/keystone` with controller-runtime, apimachinery, and client-go pinned",
          "and_then": [
            "same pattern applies to operators/c5c3/go.mod"
          ]
        },
        {
          "name": "go mod tidy is idempotent after initial setup",
          "when": "developer runs `go mod tidy` on any module after task 2.5 completes",
          "then": "go.mod and go.sum remain unchanged (no diff)",
          "and_then": [
            "all require and replace directives are preserved"
          ]
        }
      ]
    },
    {
      "id": "REQ-003",
      "description": "Operator main.go files SHALL include scheme registration (runtime + core), ctrl.NewManager creation, --leader-elect flag, and structured logging via zap",
      "priority": "SHALL",
      "rationale": "The manager setup is the entry point for all controller-runtime operators and must follow kubebuilder v4 best practices for production readiness",
      "scenarios": [
        {
          "name": "Scheme registers runtime and core K8s types",
          "when": "the main.go init() function runs",
          "then": "utilruntime.Must(clientgoscheme.AddToScheme(scheme)) registers core K8s types",
          "and_then": [
            "scheme is passed to ctrl.Options when creating the manager"
          ]
        },
        {
          "name": "Leader election is configurable via flag",
          "when": "operator binary is run with --leader-elect=true",
          "then": "the manager enables leader election with LeaderElectionID derived from operator name (e.g. keystone.openstack.c5c3.io)",
          "and_then": [
            "default is false for local development convenience"
          ]
        },
        {
          "name": "Binary compiles and go vet passes",
          "when": "developer runs `go build` and `go vet` in the operator directory",
          "then": "a binary is produced with no compilation errors and go vet reports no issues",
          "and_then": []
        }
      ]
    },
    {
      "id": "REQ-004",
      "description": "Operator main.go files SHALL configure /healthz and /readyz probe endpoints and a metrics bind address using metricsserver.Options",
      "priority": "SHALL",
      "rationale": "Health probes enable Kubernetes liveness/readiness scheduling; metrics enable Prometheus monitoring; metricsserver.Options is the modern API replacing deprecated string-based MetricsBindAddress",
      "scenarios": [
        {
          "name": "Health probe address is configurable via flag",
          "when": "the manager is created",
          "then": "HealthProbeBindAddress is set from --health-probe-bind-address flag (default :8081)",
          "and_then": []
        },
        {
          "name": "Health and readiness checks are registered",
          "when": "the manager setup completes before mgr.Start",
          "then": "mgr.AddHealthzCheck('healthz', healthz.Ping) and mgr.AddReadyzCheck('readyz', healthz.Ping) are called",
          "and_then": [
            "errors from registration cause os.Exit(1)"
          ]
        },
        {
          "name": "Metrics bind address uses metricsserver.Options",
          "when": "the manager is created",
          "then": "Metrics field uses metricsserver.Options{BindAddress: metricsAddr} with default :8080",
          "and_then": [
            "the deprecated string-based MetricsBindAddress is NOT used"
          ]
        }
      ]
    },
    {
      "id": "REQ-005",
      "description": "The Makefile SHALL support an OPERATOR variable to target individual operators, with OPERATORS defaulting to 'keystone c5c3' when unset",
      "priority": "SHALL",
      "rationale": "Developers need to iterate on individual operators without rebuilding the entire project; per architecture/01-project-setup.md:146-152",
      "scenarios": [
        {
          "name": "OPERATOR targets single operator",
          "when": "developer runs `make build OPERATOR=keystone`",
          "then": "only the keystone operator is built; c5c3 is not affected",
          "and_then": [
            "OPERATORS list is overridden to contain only 'keystone'"
          ]
        },
        {
          "name": "Default builds all operators",
          "when": "developer runs `make build` without setting OPERATOR",
          "then": "both keystone and c5c3 operators are built",
          "and_then": [
            "OPERATORS list defaults to 'keystone c5c3'"
          ]
        },
        {
          "name": "OPERATOR-to-OPERATORS override is documented",
          "when": "developer reads the Makefile header",
          "then": "a comment explains that `ifdef OPERATOR; OPERATORS := $(OPERATOR); endif` overrides the list",
          "and_then": [
            "pattern is clear for adding new operators to the OPERATORS default"
          ]
        }
      ]
    },
    {
      "id": "REQ-006",
      "description": "The Makefile SHALL define all 11 documented targets: generate, manifests, build, test, test-integration, lint, docker-build, helm-package, e2e, deploy-infra, install-test-deps",
      "priority": "SHALL",
      "rationale": "All targets must exist from the start to establish the build system contract per architecture/01-project-setup.md; stubs fail explicitly to avoid false confidence",
      "scenarios": [
        {
          "name": "Working targets execute real operations",
          "when": "developer runs `make build`, `make lint`, or `make test`",
          "then": "the target runs the real Go toolchain command (go build, golangci-lint run, go test)",
          "and_then": [
            "exit code 0 on the scaffolded codebase"
          ]
        },
        {
          "name": "Stub targets fail with informative error",
          "when": "developer runs a stub target (e.g., `make docker-build`)",
          "then": "the target exits non-zero with $(error) message referencing the feature that will implement it (e.g., 'Not implemented â€” see S006')",
          "and_then": [
            "no silent success"
          ]
        },
        {
          "name": "All 11 targets are declared with .PHONY",
          "when": "developer inspects the Makefile",
          "then": "all 11 targets are defined as .PHONY with descriptive comments",
          "and_then": [
            "targets are grouped logically: build, test, tooling, packaging, deployment"
          ]
        }
      ]
    },
    {
      "id": "REQ-007",
      "description": ".golangci.yml SHALL enable govet, errcheck, staticcheck, unused, gosimple, ineffassign, typecheck, gocritic and exclude zz_generated*.go files with Go 1.25 target",
      "priority": "SHALL",
      "rationale": "Consistent lint configuration prevents code quality regressions; generated code exclusion avoids false positives from controller-gen output",
      "scenarios": [
        {
          "name": "Standard linters are enabled",
          "when": "golangci-lint reads .golangci.yml",
          "then": "govet, errcheck, staticcheck, unused, gosimple, ineffassign, typecheck, and gocritic are all active",
          "and_then": []
        },
        {
          "name": "Generated code is excluded",
          "when": "golangci-lint processes files matching zz_generated*.go",
          "then": "those files are excluded from all linter checks via issues.exclude-files or run.skip-files",
          "and_then": [
            "exclusion pattern covers zz_generated.deepcopy.go and similar controller-gen output"
          ]
        },
        {
          "name": "Go version matches workspace",
          "when": "golangci-lint parses the configuration",
          "then": "the Go version is set to '1.25' matching go.work and go.mod directives",
          "and_then": [
            "no Go version mismatch warnings during lint"
          ]
        }
      ]
    },
    {
      "id": "REQ-008",
      "description": "Operator go.mod files SHALL include replace directives mapping internal/common to the relative path ../../internal/common for builds without go.work",
      "priority": "SHALL",
      "rationale": "CI environments and containerized builds may not use go.work; replace directives per architecture/01-project-setup.md:112-126 provide the fallback",
      "scenarios": [
        {
          "name": "Build succeeds without go.work",
          "when": "developer runs `GOWORK=off go build ./...` in operators/keystone/",
          "then": "the build succeeds using the replace directive to resolve internal/common locally",
          "and_then": [
            "no 'module not found' errors for internal/common"
          ]
        },
        {
          "name": "Replace directive uses correct relative path",
          "when": "developer inspects operators/keystone/go.mod",
          "then": "replace directive is: `replace github.com/c5c3/forge/internal/common => ../../internal/common`",
          "and_then": [
            "same pattern in operators/c5c3/go.mod"
          ]
        },
        {
          "name": "Replace directive survives go mod tidy",
          "when": "developer runs `go mod tidy` in operators/keystone/",
          "then": "the replace directive is preserved because a blank import of internal/common exists in main.go",
          "and_then": [
            "the require directive for internal/common is also preserved"
          ]
        }
      ]
    },
    {
      "id": "REQ-009",
      "description": "The directory structure SHALL match the documented monorepo layout with placeholder .gitkeep files in directories without initial content",
      "priority": "SHALL",
      "rationale": "Establishing the full directory tree from architecture/01-project-setup.md prevents restructuring in later features (S002-S026)",
      "scenarios": [
        {
          "name": "Module directories contain required files",
          "when": "developer lists internal/common/, operators/keystone/, operators/c5c3/",
          "then": "each directory contains go.mod; operators also contain main.go; internal/common contains doc.go",
          "and_then": []
        },
        {
          "name": "Placeholder directories have .gitkeep",
          "when": "developer lists images/, releases/, deploy/, tests/e2e/",
          "then": "each directory exists and contains exactly one .gitkeep file",
          "and_then": [
            "git tracks these otherwise-empty directories"
          ]
        },
        {
          "name": ".gitignore covers Go workspace and build artifacts",
          "when": "developer runs `git status` after go mod tidy and go build",
          "then": "Go build outputs (bin/, *.exe), vendor/, and IDE files are gitignored",
          "and_then": [
            "go.work.sum is NOT gitignored (committed for reproducibility)"
          ]
        }
      ]
    }
  ],
  "tasks": [
    {
      "id": "1.1",
      "title": "Create directory tree with .gitkeep files for images/, releases/, deploy/, tests/e2e/ placeholder directories (REQ-009)",
      "level": 1,
      "estimate_minutes": 10,
      "status": "done",
      "requirements": [
        "REQ-009"
      ]
    },
    {
      "id": "1.2",
      "title": "Create go.work at repository root with `go 1.25` and use directives for ./internal/common, ./operators/keystone, ./operators/c5c3 (REQ-001)",
      "level": 1,
      "estimate_minutes": 10,
      "status": "done",
      "requirements": [
        "REQ-001"
      ]
    },
    {
      "id": "1.3",
      "title": "Create internal/common/go.mod (module github.com/c5c3/forge/internal/common, go 1.25) and doc.go with `package common` placeholder (REQ-002)",
      "level": 1,
      "estimate_minutes": 10,
      "status": "done",
      "requirements": [
        "REQ-002"
      ]
    },
    {
      "id": "1.4",
      "title": "Update .gitignore to add Go workspace artifacts: bin/, vendor/, *.exe, *.test, *.out; keep go.work.sum tracked (REQ-009)",
      "level": 1,
      "estimate_minutes": 10,
      "status": "done",
      "requirements": [
        "REQ-009"
      ]
    },
    {
      "id": "2.1",
      "title": "Create operators/keystone/go.mod with module github.com/c5c3/forge/operators/keystone, go 1.25, require controller-runtime v0.23.x + apimachinery v0.35.x + client-go v0.35.x + internal/common v0.0.0, replace directive for internal/common => ../../internal/common (REQ-002, REQ-008)",
      "level": 2,
      "estimate_minutes": 15,
      "status": "done",
      "requirements": [
        "REQ-002",
        "REQ-008"
      ]
    },
    {
      "id": "2.2",
      "title": "Create operators/c5c3/go.mod with identical dependency and replace pattern as keystone (module github.com/c5c3/forge/operators/c5c3) (REQ-002, REQ-008)",
      "level": 2,
      "estimate_minutes": 15,
      "status": "done",
      "requirements": [
        "REQ-002",
        "REQ-008"
      ]
    },
    {
      "id": "2.3",
      "title": "Create operators/keystone/main.go: scheme registration (clientgoscheme + runtime), ctrl.NewManager with metricsserver.Options, --leader-elect/--metrics-bind-address/--health-probe-bind-address flags, healthz.Ping probes, blank import of internal/common, controller registration stub comment, mgr.Start(ctrl.SetupSignalHandler()) (REQ-003, REQ-004, REQ-008)",
      "level": 2,
      "estimate_minutes": 25,
      "status": "done",
      "requirements": [
        "REQ-003",
        "REQ-004",
        "REQ-008"
      ]
    },
    {
      "id": "2.4",
      "title": "Create operators/c5c3/main.go with identical manager setup pattern as keystone, different LeaderElectionID (c5c3.openstack.c5c3.io) (REQ-003, REQ-004, REQ-008)",
      "level": 2,
      "estimate_minutes": 20,
      "status": "done",
      "requirements": [
        "REQ-003",
        "REQ-004",
        "REQ-008"
      ]
    },
    {
      "id": "2.5",
      "title": "Run `go mod tidy` on all 3 modules to resolve dependencies and generate go.sum files; verify `go build ./...` succeeds from workspace root and from each module with GOWORK=off (REQ-001, REQ-002, REQ-008)",
      "level": 3,
      "estimate_minutes": 15,
      "status": "done",
      "requirements": [
        "REQ-001",
        "REQ-002",
        "REQ-008"
      ]
    },
    {
      "id": "3.1",
      "title": "Create .golangci.yml: enable govet/errcheck/staticcheck/unused/gosimple/ineffassign/typecheck/gocritic, set Go 1.25, exclude zz_generated*.go via issues.exclude-files, set appropriate timeout (REQ-007)",
      "level": 3,
      "estimate_minutes": 15,
      "status": "done",
      "requirements": [
        "REQ-007"
      ]
    },
    {
      "id": "3.2",
      "title": "Create top-level Makefile: OPERATORS='keystone c5c3' default, ifdef OPERATOR override, working targets (build: `go build ./...` per module, test: `go test ./...`, lint: `golangci-lint run`, generate/manifests: echo no-op until controller-gen exists), stub targets with $(error) for docker-build(S006)/helm-package(S017)/e2e(S002)/deploy-infra(S008)/install-test-deps(S002)/test-integration(S002), .PHONY declarations, descriptive comments (REQ-005, REQ-006)",
      "level": 3,
      "estimate_minutes": 30,
      "status": "done",
      "requirements": [
        "REQ-005",
        "REQ-006"
      ]
    },
    {
      "id": "4.1",
      "title": "Verify scaffolded workspace structure aligns with architecture/01-project-setup.md; document any deviations (metricsserver.Options vs deprecated MetricsBindAddress, stub target error behavior) in a brief reference section or inline comments (REQ-001, REQ-009)",
      "level": 4,
      "estimate_minutes": 15,
      "status": "done",
      "requirements": [
        "REQ-001",
        "REQ-009"
      ]
    }
  ],
  "test_specifications": [
    {
      "test_file": "go.work",
      "test_function": "verify_workspace_build",
      "story": "Developer builds all operators from workspace root",
      "expected": "`go build ./...` from workspace root succeeds; all three modules resolve locally without network fetch for internal/common",
      "requirement_id": "REQ-001"
    },
    {
      "test_file": "go.work",
      "test_function": "verify_go_version_directive",
      "story": "Developer builds all operators from workspace root",
      "expected": "go.work contains `go 1.25` and `use` directives for ./internal/common, ./operators/keystone, ./operators/c5c3",
      "requirement_id": "REQ-001"
    },
    {
      "test_file": "internal/common/go.mod",
      "test_function": "verify_common_module_path",
      "story": "Developer extends the project with new operators following established patterns",
      "expected": "Module path is `github.com/c5c3/forge/internal/common` with `go 1.25`; `go mod verify` succeeds",
      "requirement_id": "REQ-002"
    },
    {
      "test_file": "operators/keystone/go.mod",
      "test_function": "verify_keystone_dependencies",
      "story": "Developer builds all operators from workspace root",
      "expected": "Module path is `github.com/c5c3/forge/operators/keystone`; requires controller-runtime v0.23.x, apimachinery v0.35.x, client-go v0.35.x",
      "requirement_id": "REQ-002"
    },
    {
      "test_file": "operators/keystone/main.go",
      "test_function": "verify_scheme_registration",
      "story": "Developer builds all operators from workspace root",
      "expected": "main.go init() calls utilruntime.Must(clientgoscheme.AddToScheme(scheme)) to register core K8s types; scheme is passed to ctrl.Options",
      "requirement_id": "REQ-003"
    },
    {
      "test_file": "operators/keystone/main.go",
      "test_function": "verify_leader_election_flag",
      "story": "Developer builds all operators from workspace root",
      "expected": "main.go parses --leader-elect bool flag (default false); LeaderElectionID is 'keystone.openstack.c5c3.io'",
      "requirement_id": "REQ-003"
    },
    {
      "test_file": "operators/keystone/main.go",
      "test_function": "verify_health_probe_setup",
      "story": "Platform engineer verifies operator health via standard probe endpoints",
      "expected": "HealthProbeBindAddress set from --health-probe-bind-address (default :8081); mgr.AddHealthzCheck and mgr.AddReadyzCheck called with healthz.Ping",
      "requirement_id": "REQ-004"
    },
    {
      "test_file": "operators/c5c3/main.go",
      "test_function": "verify_metrics_server_options",
      "story": "Platform engineer verifies operator health via standard probe endpoints",
      "expected": "Metrics field uses metricsserver.Options{BindAddress: metricsAddr} with --metrics-bind-address flag (default :8080); deprecated string MetricsBindAddress is NOT used",
      "requirement_id": "REQ-004"
    },
    {
      "test_file": "Makefile",
      "test_function": "verify_single_operator_targeting",
      "story": "Developer targets individual operator builds via Makefile",
      "expected": "`make build OPERATOR=keystone` only builds keystone; c5c3 is not compiled",
      "requirement_id": "REQ-005"
    },
    {
      "test_file": "Makefile",
      "test_function": "verify_default_all_operators",
      "story": "Developer targets individual operator builds via Makefile",
      "expected": "`make build` without OPERATOR builds both keystone and c5c3; OPERATORS defaults to 'keystone c5c3'",
      "requirement_id": "REQ-005"
    },
    {
      "test_file": "Makefile",
      "test_function": "verify_all_11_targets_defined",
      "story": "Developer builds all operators from workspace root",
      "expected": "All 11 targets (generate, manifests, build, test, test-integration, lint, docker-build, helm-package, e2e, deploy-infra, install-test-deps) are defined with .PHONY",
      "requirement_id": "REQ-006"
    },
    {
      "test_file": "Makefile",
      "test_function": "verify_stub_targets_fail_explicitly",
      "story": "Developer builds all operators from workspace root",
      "expected": "Stub targets (docker-build, helm-package, e2e, deploy-infra, install-test-deps, test-integration) exit non-zero with $(error) message referencing implementing feature (e.g., 'Not implemented â€” see S006')",
      "requirement_id": "REQ-006"
    },
    {
      "test_file": ".golangci.yml",
      "test_function": "verify_lint_passes_clean",
      "story": "Developer has consistent lint configuration across all modules",
      "expected": "`golangci-lint run ./...` succeeds with zero violations on the scaffolded codebase",
      "requirement_id": "REQ-007"
    },
    {
      "test_file": ".golangci.yml",
      "test_function": "verify_linter_configuration",
      "story": "Developer has consistent lint configuration across all modules",
      "expected": "Config enables govet, errcheck, staticcheck, unused, gosimple, ineffassign, typecheck, gocritic; sets Go 1.25; excludes zz_generated*.go",
      "requirement_id": "REQ-007"
    },
    {
      "test_file": "operators/keystone/go.mod",
      "test_function": "verify_build_without_gowork",
      "story": "CI system builds operators independently without go.work",
      "expected": "`GOWORK=off go build ./...` in operators/keystone/ succeeds using replace directive; no 'module not found' errors",
      "requirement_id": "REQ-008"
    },
    {
      "test_file": "operators/c5c3/go.mod",
      "test_function": "verify_replace_directive_path",
      "story": "CI system builds operators independently without go.work",
      "expected": "Replace directive: `replace github.com/c5c3/forge/internal/common => ../../internal/common`; directive survives go mod tidy",
      "requirement_id": "REQ-008"
    },
    {
      "test_file": ".",
      "test_function": "verify_directory_tree_exists",
      "story": "Developer extends the project with new operators following established patterns",
      "expected": "Directories internal/common/, operators/keystone/, operators/c5c3/, images/, releases/, deploy/, tests/e2e/ all exist",
      "requirement_id": "REQ-009"
    },
    {
      "test_file": ".",
      "test_function": "verify_gitkeep_and_gitignore",
      "story": "Developer extends the project with new operators following established patterns",
      "expected": ".gitkeep files in images/, releases/, deploy/, tests/e2e/; .gitignore includes Go build artifacts; go.work.sum is NOT gitignored",
      "requirement_id": "REQ-009"
    }
  ],
  "affected_files": [],
  "similar_patterns": [],
  "review_criteria": [
    "All go.mod files declare correct module paths matching github.com/c5c3/forge/<path> convention from architecture/01-project-setup.md",
    "`go build ./...` succeeds from workspace root with zero compilation errors; `go vet ./...` reports no issues",
    "Both operator main.go files include scheme registration, ctrl.NewManager with metricsserver.Options, --leader-elect flag, /healthz and /readyz probes, and structured zap logging",
    "`golangci-lint run` passes with the configured .golangci.yml across all modules with zero violations",
    "Makefile OPERATOR variable correctly targets individual operators; `make build` without OPERATOR builds all; stub targets fail explicitly with $(error)",
    "Replace directives in operator go.mod files enable `GOWORK=off go build ./...` in each operator directory",
    "`go mod tidy` is idempotent on all modules (no changes to go.mod or go.sum after initial setup)",
    "Directory structure matches architecture/01-project-setup.md layout; .gitkeep files in placeholder directories; .gitignore covers Go build artifacts"
  ],
  "implementation_notes": "Architectural decisions: (1) Hand-crafted main.go instead of `operator-sdk init` â€” the SDK scaffolds many files (config/, internal/controller/, Dockerfile, Makefile) that would be immediately deleted for this minimal scaffolding feature; the main.go follows kubebuilder v4 / controller-runtime v0.23+ patterns directly. (2) Blank import `_ \"github.com/c5c3/forge/internal/common\"` in both main.go files keeps the require/replace directives alive through `go mod tidy` â€” without this, go mod tidy strips unused dependencies and the replace directive per REQ-008 would be lost. (3) Makefile stub targets use `$(error \"Not implemented â€” see SXXX\")` to fail explicitly rather than silently succeeding, preventing false confidence that a target works when it doesn't. (4) Metrics uses `metricsserver.Options{BindAddress: metricsAddr}` (the struct-based API) rather than the deprecated `MetricsBindAddress` string field, following controller-runtime v0.23+ best practices. (5) `go.work.sum` is committed per Go team recommendation for reproducibility. (6) The `generate` and `manifests` Makefile targets are no-ops (echo) rather than errors because they're valid targets that simply have no generators registered yet â€” controller-gen will be added in S011 when CRD types exist. (7) Module paths use `github.com/c5c3/forge/` matching all documentation examples consistently. (8) The OPERATOR/OPERATORS pattern in the Makefile follows the documented approach: `ifdef OPERATOR; OPERATORS := $(OPERATOR); endif` converts single-operator targeting to the iteration variable.",
  "status_history": {
    "draft": {
      "github_account": "berendt",
      "timestamp": "2026-02-22T20:42:36.260667"
    },
    "elaborated": {
      "github_account": "berendt",
      "timestamp": "2026-02-22T20:47:31.662298"
    },
    "preparing": {
      "github_account": "berendt",
      "timestamp": "2026-02-22T21:38:35.679079"
    },
    "prepared": {
      "github_account": "berendt",
      "timestamp": "2026-02-22T21:47:57.270195"
    },
    "processing": {
      "github_account": "berendt",
      "timestamp": "2026-02-28T21:19:52.145176"
    },
    "completed": {
      "github_account": "berendt",
      "timestamp": "2026-02-28T22:19:33.485592"
    }
  },
  "github_pr": "https://github.com/C5C3/forge/pull/1",
  "pr_number": 1,
  "execution_history": [
    {
      "run_id": "a9d4235e-b871-4057-aa72-ed54ae8b3b93",
      "timestamp": "2026-02-22T21:47:57.270235",
      "total_duration": 558.868492603302,
      "status": "completed",
      "timings": [
        {
          "name": "prepare",
          "duration": 558.868492603302,
          "type": "prepare",
          "status": "done"
        }
      ]
    },
    {
      "run_id": "08921bde-4e95-401d-ad6a-e506b34d30cb",
      "timestamp": "2026-02-28T21:45:30.190847",
      "total_duration": 1417.048593044281,
      "status": "completed",
      "timings": [
        {
          "name": "Level 1 (4 tasks)",
          "duration": 128.9915041923523,
          "type": "level",
          "status": "done"
        },
        {
          "name": "Level 2 (4 tasks)",
          "duration": 193.5277271270752,
          "type": "level",
          "status": "done"
        },
        {
          "name": "Level 3 (3 tasks)",
          "duration": 348.87676453590393,
          "type": "level",
          "status": "done"
        },
        {
          "name": "Level 4 (1 tasks)",
          "duration": 253.87928223609924,
          "type": "level",
          "status": "done"
        },
        {
          "name": "[CC-0001] Code Review",
          "duration": 226.10679244995117,
          "type": "review",
          "status": "done"
        },
        {
          "name": "[CC-0001] Improvements",
          "duration": 123.38353180885315,
          "type": "improve",
          "status": "done"
        },
        {
          "name": "[CC-0001] Simplify",
          "duration": 142.28299069404602,
          "type": "simplify",
          "status": "done"
        }
      ]
    }
  ]
}